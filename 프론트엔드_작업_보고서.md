# 키오스크 애플리케이션 프론트엔드 개발 보고서

## 1. 프로젝트 개요

본 프로젝트는 음성 인식 기반 키오스크 애플리케이션의 프론트엔드 개발을 담당하였습니다. React Native와 Expo Router를 활용하여 사용자 친화적인 주문 인터페이스를 구현하였으며, 백엔드 AI 서버와의 실시간 통신을 통해 음성 주문 및 화면 전환 기능을 구현하였습니다.

## 2. 주요 개발 내용

### 2.1 음성 인식 및 백엔드 통신 시스템 구축

**문제 상황:**
- 초기에는 음성 입력과 버튼 클릭 시 백엔드와의 통신이 제대로 이루어지지 않아 화면 전환이 원활하지 않았습니다.
- 백엔드 응답을 기다리지 않고 프론트엔드에서만 처리하거나, 반대로 백엔드 응답을 기다리지 않아 메뉴 인식이 되지 않는 문제가 발생했습니다.

**해결 과정:**
1. `AIChatContext.js`에 음성 메시지 전송 함수(`sendVoiceMessage`)를 구현하여 백엔드와의 WebSocket 통신을 구축했습니다.
2. 각 화면(`MenuListScreen`, `TemperatureSelectionScreen`, `SizeSelectionScreen`, `OptionSelectionScreen`)에서 백엔드 응답의 `context.step` 값을 확인하여 적절한 화면으로 자동 전환되도록 로직을 구현했습니다.
3. 백엔드 응답을 기다린 후 메뉴 정보(`menu_id`, `menu_name`)가 확인되면 화면을 전환하고, 인식되지 않을 경우 프론트엔드 정보를 활용하는 fallback 메커니즘을 추가했습니다.

**결과:**
- 음성 입력 또는 버튼 클릭 시 백엔드와 정상적으로 통신하며, 응답에 따라 자동으로 다음 화면으로 전환됩니다.
- 메뉴 선택 → 온도 선택 → 사이즈 선택 → 옵션 선택 → 장바구니 → 결제의 전체 플로우가 원활하게 동작합니다.

### 2.2 장바구니 관리 시스템 통합

**문제 상황:**
- 장바구니 추가 로직이 여러 곳에 분산되어 있어(`addCartItem`, `SizeSelectionScreen`의 useEffect 등) 유지보수가 어려웠습니다.
- 동일한 메뉴를 추가할 때 수량이 중복으로 증가하거나, 장바구니에 표시되지 않는 문제가 있었습니다.

**해결 과정:**
1. 모든 장바구니 추가 로직을 `addCartItem` 함수로 통합하여 단일 진입점을 만들었습니다.
2. `AIChatContext`에 `setAddToCartCallback`을 구현하여 각 화면에서 장바구니 콜백을 등록할 수 있도록 했습니다.
3. 백엔드 응답의 `backend_payload`에 `add_to_cart` 플래그가 있을 때 자동으로 `addCartItem`을 호출하도록 구현했습니다.
4. 디저트 메뉴(티라미수, 치즈케이크 등)는 온도/사이즈 선택이 필요 없으므로 별도 처리하여 바로 장바구니에 추가되도록 했습니다.

**결과:**
- 장바구니 추가 로직이 한 곳에서 관리되어 유지보수가 용이해졌습니다.
- 메뉴 수량이 정확하게 관리되며, 여러 메뉴를 동시에 장바구니에 담을 수 있습니다.

### 2.3 UI 요소 하이라이트 기능 구현

**문제 상황:**
- 사용자가 "아메리카노 어디 있어?"와 같은 위치 질문을 할 때, 백엔드가 `target_element_id`를 제공하지만 프론트엔드에서 이를 처리하는 로직이 없었습니다.
- 메뉴뿐만 아니라 장바구니 영역, 홈 버튼, 이전/다음 버튼 등 다양한 UI 요소를 하이라이트해야 하는 요구사항이 있었습니다.

**해결 과정:**
1. 백엔드 응답의 `target_element_id`를 파싱하여 메뉴, 장바구니, 홈 버튼, 결제 버튼, 이전/다음 버튼 등으로 분류하는 로직을 구현했습니다.
2. `Animated.loop`을 사용하여 빨간색 테두리와 배경색이 깜빡이는 애니메이션을 구현했습니다 (10회 반복, 약 10초간).
3. "이전으로 가려면 어떻게해?" 같은 질문에 대해 백엔드 응답을 기다리지 않고 즉시 해당 버튼을 하이라이트하도록 패턴 매칭 로직을 추가했습니다.
4. 각 화면(`MenuListScreen`, `TemperatureSelectionScreen`, `SizeSelectionScreen`, `OptionSelectionScreen`)에 하이라이트 기능을 적용했습니다.

**결과:**
- 사용자가 위치를 물어볼 때 해당 UI 요소가 빨간색으로 깜빡이며 시각적으로 안내됩니다.
- "이전으로 가려면 어떻게해?" 질문 시 즉시 이전 버튼이 하이라이트되어 사용자 경험이 향상되었습니다.

### 2.4 화면 전환 로직 개선 및 Step 처리

**문제 상황:**
- 백엔드가 `step: "temp"`를 보내는데 프론트엔드에서 `step === 'temperature'`로만 체크하여 화면 전환이 되지 않았습니다.
- `step: "size"`를 보내도 인식하지 못하여 "알 수 없는 step" 에러가 발생했습니다.
- 디저트 메뉴에 대한 "있어?" 질문 시에도 온도 선택 화면으로 이동하는 문제가 있었습니다.

**해결 과정:**
1. 각 화면의 `handleAIResponse` 함수에서 백엔드 `context.step` 값을 확인하여 적절한 화면으로 전환하도록 수정했습니다.
2. `TemperatureSelectionScreen`에 `case 'temp':`와 `case 'temperature':`를 추가하여 두 가지 형식 모두 처리하도록 했습니다.
3. `SizeSelectionScreen`에 `case 'size':`를 추가하여 사이즈 선택 단계에서 현재 화면에 머무르도록 했습니다.
4. 디저트 메뉴에 대한 "있어?" 질문을 감지하는 정규식 패턴을 추가하고, 백엔드 응답의 `stt_text`도 함께 확인하도록 했습니다.
5. 디저트 메뉴 존재 질문이 감지되면 화면 전환을 막는 로직을 step 처리 전에 추가했습니다.

**결과:**
- 모든 step 값(`temp`, `temperature`, `size`, `menu_item` 등)이 정확하게 처리됩니다.
- "티라미수 있어?", "치즈케이크 있어?" 같은 질문 시 온도 선택 화면으로 이동하지 않고 메뉴 리스트 화면에 머뭅니다.

### 2.5 텍스트 크기 조절 기능 구현

**문제 상황:**
- 사용자가 "텍스트 크기 키워줘"라고 요청했을 때 전체 텍스트 크기를 조절하는 기능이 필요했습니다.
- 여러 화면에서 일관되게 텍스트 크기를 조절할 수 있어야 했습니다.

**해결 과정:**
1. 각 화면에 `textSizeMultiplier` state를 추가하여 텍스트 크기 배율을 관리했습니다.
2. "텍스트 크기 키워줘" 패턴을 감지하면 배율을 1.2배(20% 증가)로 설정하고, "텍스트 크기 기본값 적용" 패턴을 감지하면 1.0으로 복원하도록 구현했습니다.
3. 모든 텍스트에 `fontSize * textSizeMultiplier`를 적용하여 동적으로 크기가 변경되도록 했습니다.
4. 메뉴 리스트 화면, 온도 선택 화면, 사이즈 선택 화면, 옵션 선택 화면에 텍스트 크기 조절 버튼(+/-)을 추가하여 수동으로도 조절할 수 있도록 했습니다.

**결과:**
- 음성 명령 또는 버튼 클릭으로 전체 텍스트 크기를 조절할 수 있습니다.
- 모든 화면에서 일관된 텍스트 크기 조절 기능이 제공됩니다.

### 2.6 결제 시스템 구현

**문제 상황:**
- 결제 수단 선택, 카드 삽입, 바코드 인식, 결제 완료 등의 화면이 필요했습니다.
- 쿠폰 결제 시 바코드 인식 화면이 표시되지 않는 문제가 있었습니다.

**해결 과정:**
1. 결제 수단 선택 모달을 구현하여 카드 결제, 쿠폰 결제 옵션을 제공했습니다.
2. 쿠폰 결제 선택 시 바코드 인식 화면을 표시하고, 10초 후 자동으로 결제 중 화면으로 전환되도록 구현했습니다.
3. 결제 중 화면에서 2초 후 결제 완료 화면이 표시되도록 타이머를 설정했습니다.
4. 결제 완료 화면의 엑스 버튼이 긴 제목에 의해 삐져나오는 문제를 해결하기 위해 flex 레이아웃을 조정했습니다.

**결과:**
- 전체 결제 플로우가 원활하게 동작하며, 쿠폰 결제 시 바코드 인식 화면이 정상적으로 표시됩니다.
- 결제 완료 화면의 레이아웃이 안정적으로 표시됩니다.

### 2.7 UI/UX 개선

**문제 상황:**
- 옵션 선택 화면에서 "이전으로", "다음으로" 버튼이 화면 중간에 위치하여 접근성이 떨어졌습니다.
- 음성 인식 버튼이 일부 화면에만 있어 일관성이 부족했습니다.

**해결 과정:**
1. 옵션 선택 화면의 버튼을 `position: 'absolute'`로 설정하여 화면 하단에 고정 배치했습니다.
2. 주문 내역 확인, 결제 수단 선택, 카드 삽입, 바코드 인식 화면에 음성 인식 버튼을 추가했습니다.
3. 결제 완료 화면에서는 음성 입력이 불필요하므로 버튼을 제거했습니다.
4. 음성 인식 버튼을 원형으로 디자인하고 마이크 이미지를 적용하여 시각적 일관성을 높였습니다.

**결과:**
- 모든 화면에서 일관된 UI/UX를 제공하며, 버튼 접근성이 향상되었습니다.
- 음성 입력 기능이 필요한 모든 화면에서 사용할 수 있습니다.

### 2.8 "이전" 질문 처리 개선

**문제 상황:**
- "이전으로 어떻게 가?"라고 질문했을 때 장바구니 수량이 증가하는 문제가 있었습니다.
- 백엔드 응답을 기다려야 하이라이트가 표시되어 즉각적인 피드백이 부족했습니다.

**해결 과정:**
1. 백엔드 응답의 `stt_text`와 `response_text`에 "이전" 관련 키워드가 포함되어 있으면 장바구니 추가를 하지 않도록 체크 로직을 추가했습니다.
2. "이전으로 가려면 어떻게해?" 패턴을 감지하면 백엔드 응답을 기다리지 않고 즉시 이전 버튼을 하이라이트하도록 구현했습니다.
3. 각 화면(`SizeSelectionScreen`, `TemperatureSelectionScreen`, `OptionSelectionScreen`, `MenuListScreen`)에 동일한 로직을 적용했습니다.

**결과:**
- "이전" 질문 시 장바구니에 추가되지 않으며, 즉시 이전 버튼이 하이라이트되어 사용자 경험이 향상되었습니다.

## 3. 기술적 도전과 해결

### 3.1 백엔드와의 비동기 통신 처리

백엔드 응답을 기다리는 동안 사용자 경험이 저하되지 않도록, 로딩 상태 표시와 함께 fallback 메커니즘을 구현했습니다. 백엔드가 메뉴를 인식하지 못할 경우 프론트엔드의 메뉴 정보를 활용하여 화면 전환을 진행하도록 했습니다.

### 3.2 상태 관리 및 데이터 정규화

백엔드에서 받은 메뉴 ID 형식(`COFFEE_AMERICANO`)과 프론트엔드 형식(`americano`)을 변환하는 유틸리티 함수를 구현하여 데이터 일관성을 유지했습니다. 또한 온도 값(`ice` → `cold`), 사이즈 값(`tall/grande/venti` → `small/medium/large`) 등도 변환하여 통일된 형식으로 관리했습니다.

### 3.3 애니메이션 성능 최적화

하이라이트 애니메이션을 구현할 때 `useNativeDriver: false`를 사용하여 레이아웃 속성(테두리, 배경색)을 애니메이션할 수 있도록 했습니다. 애니메이션이 완료되면 자동으로 정리되어 메모리 누수를 방지했습니다.

## 4. 개발 결과

본 프로젝트를 통해 음성 인식 기반 키오스크 애플리케이션의 프론트엔드를 성공적으로 구현하였습니다. 백엔드 AI 서버와의 실시간 통신, 직관적인 UI/UX, 다양한 접근성 기능을 제공하는 완성도 높은 애플리케이션을 개발하였습니다. 특히 사용자 질문에 대한 즉각적인 시각적 피드백과 정확한 화면 전환 로직을 통해 사용자 경험을 크게 향상시켰습니다.

