# 키오스크 애플리케이션 프론트엔드 개발 보고서

## 1. 프로젝트 개요

React Native와 Expo 환경을 기반으로 음성 인터랙션을 지원하는 키오스크 프론트엔드를 구현하였다. Expo Router를 활용해 화면 전환 구조를 설계하였고, 사용자가 주문 과정에서 음성 또는 터치 중 원하는 입력 방식을 선택하여 자연스럽게 조작할 수 있도록 인터페이스를 구성하였다.

## 2. AI 연동 기반 UI 하이라이트 시스템 구현

### 2.1 백엔드 응답 기반 동적 하이라이트 메커니즘

음성 처리 흐름은 `expo-av`로 녹음된 음성을 FormData 형태로 변환하여 백엔드의 `/session/voice` 엔드포인트로 전송하는 방식으로 구현하였다. 백엔드에서 반환되는 응답에는 `target_element_id` 필드가 포함되어 있으며, 이를 기반으로 특정 UI 요소를 시각적으로 하이라이트하는 기능을 구현하였다.

**구현 과정:**

백엔드로부터 전달받는 `target_element_id`를 파싱하여 메뉴 아이템, 장바구니 영역, 홈 버튼, 결제 버튼, 이전/다음 버튼 등으로 분류하는 로직을 구현하였다. 예를 들어 `target_element_id`가 `"menu_item_coffee_americano"`인 경우, 이를 파싱하여 메뉴 타입으로 인식하고 `"americano"` ID를 추출하여 해당 메뉴 카드를 하이라이트하도록 설계하였다.

하이라이트 애니메이션은 React Native의 `Animated` API를 활용하여 구현하였다. `Animated.loop`과 `Animated.sequence`를 조합하여 빨간색 테두리와 배경색이 깜빡이는 효과를 생성하였으며, 10회 반복(약 10초간) 후 자동으로 원래 상태로 복귀하도록 구성하였다. 테두리 색상은 `#ef4444`에서 `#dc2626`으로, 배경색은 `#fee2e2`에서 `#fecaca`로 변화하여 시각적 강조 효과를 제공하였다.

### 2.2 즉각적인 하이라이트 피드백 구현

사용자가 "이전으로 가려면 어떻게해?"와 같은 질문을 했을 때, 백엔드 응답을 기다리지 않고 즉시 해당 버튼을 하이라이트하도록 패턴 매칭 로직을 구현하였다. 각 화면의 `handleAIResponse` 함수 시작 부분에서 사용자 메시지(`lastUserMessage.text`)와 백엔드 응답의 `stt_text`를 확인하여 "이전.*가려면.*어떻게", "이전.*어떻게.*가" 등의 정규식 패턴과 매칭되면 즉시 하이라이트를 시작하도록 설계하였다.

이를 통해 사용자가 질문을 한 직후 시각적 피드백을 받을 수 있어 사용자 경험이 크게 향상되었다. 특히 메뉴 리스트 화면, 온도 선택 화면, 사이즈 선택 화면, 옵션 선택 화면 모두에서 일관된 하이라이트 동작을 제공하도록 구현하였다.

### 2.3 다중 UI 요소 하이라이트 지원

하이라이트 시스템은 메뉴 카드뿐만 아니라 장바구니 영역, 홈 버튼, 이전/다음 버튼 등 다양한 UI 요소를 지원하도록 확장하였다. `target_element_id` 파싱 로직에서 `cart`, `home`, `back`, `next`, `pay` 등의 키워드를 감지하여 각각의 UI 요소 타입으로 분류하고, 해당 요소에 맞는 하이라이트 스타일을 적용하도록 구현하였다.

예를 들어 장바구니 영역의 경우 회색 배경(`#f3f4f6`)을 기본으로 하되, 하이라이트 시 빨간색 테두리로 강조되도록 설계하였다. 이를 통해 사용자가 "장바구니 어디 있어?"라고 질문했을 때 장바구니 영역이 명확하게 표시된다.

## 3. AI와 음성 인식 연동 시스템

### 3.1 음성 녹음 및 전송 프로세스

음성 처리 흐름은 `expo-av`의 `Audio.Recording` API를 활용하여 구현하였다. 사용자가 음성 입력 버튼을 누르면 녹음이 시작되고, 다시 누르면 녹음이 중지되며 자동으로 백엔드로 전송되는 토글 방식으로 설계하였다.

녹음된 오디오 파일은 `FormData` 형태로 변환하여 백엔드의 `/session/voice?session_id={sessionId}` 엔드포인트로 POST 요청을 전송한다. FormData에는 `file` 필드로 오디오 URI, MIME 타입(`audio/3gpp`), 파일명(`voice.m4a`)이 포함되며, React Native의 네이티브 FormData 구현을 활용하여 멀티파트 요청을 구성하였다.

### 3.2 백엔드 응답 기반 자동 화면 전환

백엔드에서 반환되는 응답에는 `context.step` 값이 포함되어 있으며, 이를 바탕으로 온도 선택, 사이즈 선택, 옵션 선택, 결제 화면 등 다음 단계가 자동으로 전환되도록 설계하였다. 각 화면의 `handleAIResponse` 함수에서 `context.step` 값을 확인하여 적절한 화면으로 라우팅하는 로직을 구현하였다.

예를 들어 `step: "temp"` 또는 `step: "temperature"`인 경우 `TemperatureSelectionScreen`으로, `step: "size"`인 경우 `SizeSelectionScreen`으로, `step: "options"` 또는 `step: "option"`인 경우 `OptionSelectionScreen`으로 자동 전환되도록 구성하였다. 또한 메뉴 정보(`menu_id`, `menu_name`)가 백엔드 응답에 포함되어 있으면 이를 파라미터로 전달하여 다음 화면에서 사용할 수 있도록 구현하였다.

### 3.3 TTS 기반 음성 안내 시스템

각 단계의 안내는 `expo-speech`를 사용해 TTS로 재생하여 사용자 경험을 향상하였다. 백엔드 응답에 포함된 `tts_url`을 통해 TTS 오디오 파일을 다운로드하여 재생하거나, `response_text`를 직접 `expo-speech`의 `speak` 함수로 재생하도록 구현하였다. 이를 통해 시각 장애인이나 화면을 보기 어려운 상황에서도 음성으로 안내를 받을 수 있도록 접근성을 확보하였다.

### 3.4 세션 관리 및 상태 유지

AI 세션 관리는 `AIChatContext`를 통해 전역적으로 관리되며, 각 음성 입력마다 동일한 `sessionId`를 사용하여 대화 맥락을 유지하도록 구현하였다. 세션 시작 시 백엔드의 `/session/start` 엔드포인트를 호출하여 고유한 세션 ID를 발급받고, 이후 모든 음성 및 텍스트 요청에 이 세션 ID를 포함시켜 대화 흐름을 유지하도록 설계하였다.

## 4. 직관적인 화면 구성 및 사용자 경험 설계

### 4.1 하이브리드 입력 방식 지원

UI·UX 측면에서는 모든 주요 화면에 음성 입력 버튼을 배치하여 터치 기반으로도 음성 녹음을 시작할 수 있도록 하였다. 음성 입력 버튼은 원형 디자인으로 통일하고, 마이크 아이콘을 중앙에 배치하여 직관적으로 인식할 수 있도록 구성하였다. 버튼 크기는 `width: 100, height: 100`으로 설정하여 터치하기 쉽도록 설계하였으며, 화면 하단 중앙 또는 오른쪽에 배치하여 일관된 사용자 경험을 제공하였다.

### 4.2 단계별 화면 전환 구조

주문 흐름은 메뉴 선택 → 온도 선택 → 사이즈 선택 → 옵션 선택 → 장바구니 확인 → 결제 수단 선택 → 결제 완료의 단계로 구성되어 있으며, 각 단계는 Expo Router의 `router.push`를 통해 전환된다. 각 화면은 이전 단계에서 선택한 정보를 파라미터로 받아 표시하며, "이전으로" 버튼을 통해 이전 단계로 돌아갈 수 있도록 구현하였다.

특히 옵션 선택 화면에서는 "이전으로", "다음으로" 버튼을 화면 하단에 `position: 'absolute'`로 고정 배치하여 스크롤과 관계없이 항상 접근 가능하도록 설계하였다. 이를 통해 사용자가 긴 옵션 목록을 스크롤하더라도 항상 다음 단계로 진행할 수 있는 버튼에 접근할 수 있다.

### 4.3 접근성 중심 기능 구현

메뉴와 옵션 화면에는 텍스트 크기 조절 기능을 공통적으로 제공하였다. 사용자가 "텍스트 크기 키워줘"라고 음성으로 요청하거나 화면 오른쪽에 배치된 +/- 버튼을 통해 텍스트 크기를 조절할 수 있다. 텍스트 크기 배율은 `textSizeMultiplier` state로 관리되며, 모든 텍스트 요소에 `fontSize * textSizeMultiplier`를 적용하여 동적으로 크기가 변경되도록 구현하였다.

### 4.4 결제 흐름의 자연스러운 구성

결제 흐름 또한 주문 확인에서 결제 완료까지 실제 키오스크와 유사한 단계 구조로 구현해 자연스러운 사용자 경험을 마련하였다. 결제 수단 선택 모달에서는 카드 결제와 쿠폰 결제 옵션을 제공하며, 쿠폰 결제 선택 시 바코드 인식 화면이 표시된다. 바코드 인식 화면은 스마트폰 일러스트레이션과 함께 바코드 패턴을 시각적으로 표현하여 사용자에게 명확한 안내를 제공한다.

결제 중 화면에서는 `ActivityIndicator`를 표시하여 처리 중임을 알리고, 2초 후 자동으로 결제 완료 화면으로 전환된다. 결제 완료 화면은 체크마크 배지와 함께 완료 메시지를 표시하며, 엑스 버튼을 통해 닫을 수 있도록 구성하였다. 엑스 버튼은 제목이 길어도 삐져나오지 않도록 flex 레이아웃을 조정하여 안정적인 UI를 제공한다.

## 5. 기술적 구현 세부사항

### 5.1 상태 관리 및 데이터 정규화

백엔드에서 받은 메뉴 ID 형식(`COFFEE_AMERICANO`)과 프론트엔드 형식(`americano`)을 변환하는 유틸리티 함수를 구현하여 데이터 일관성을 유지하였다. 또한 온도 값(`ice` → `cold`), 사이즈 값(`tall/grande/venti` → `small/medium/large`) 등도 변환하여 통일된 형식으로 관리하였다.

### 5.2 에러 처리 및 Fallback 메커니즘

백엔드 응답을 기다리는 동안 사용자 경험이 저하되지 않도록, 로딩 상태 표시와 함께 fallback 메커니즘을 구현하였다. 백엔드가 메뉴를 인식하지 못할 경우 프론트엔드의 메뉴 정보를 활용하여 화면 전환을 진행하도록 하였으며, 네트워크 오류 발생 시 사용자에게 재시도 안내를 제공하도록 설계하였다.

### 5.3 성능 최적화

하이라이트 애니메이션을 구현할 때 `useNativeDriver: false`를 사용하여 레이아웃 속성(테두리, 배경색)을 애니메이션할 수 있도록 하였다. 애니메이션이 완료되면 자동으로 정리되어 메모리 누수를 방지하도록 구현하였으며, `useCallback`과 `useMemo`를 활용하여 불필요한 리렌더링을 최소화하였다.

## 6. 개발 결과 및 성과

이와 같은 개선을 통해 프론트엔드 측에서는 음성 인식과 터치 입력을 모두 지원하는 하이브리드 키오스크 인터페이스를 완성하였다. 메뉴 탐색, 옵션 선택, 장바구니 관리, 결제까지의 전체 흐름이 하나의 AI 세션과 연동되어 자연스럽게 이어지며, UI 하이라이트와 텍스트 크기 조절 등 접근성 중심 기능을 실시간으로 제공하도록 설계하였다.

특히 AI 연동을 통한 동적 하이라이트 기능은 사용자가 위치를 물어볼 때 즉각적인 시각적 피드백을 제공하여 사용자 경험을 크게 향상시켰으며, 음성 인식과 터치 입력을 모두 지원하는 하이브리드 인터페이스는 다양한 사용자 그룹의 니즈를 충족시킬 수 있도록 구성하였다.

